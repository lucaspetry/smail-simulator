<!doctype html>
<html lang="pt-br">
    
<head>
    <meta charset="utf-8">
    <meta name="description" content="Smail: Simulator">
    <meta name="author" content="Lucas May Petry">
    
    <title>Smail: Simulador</title>
    
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/menu.css">
    
    <script src="js/function.js"></script>
    <script src="js/operationCenter.js"></script>
    <script src="js/smailSimulator.js"></script>
</head>

<body>
    <div id="menu">
        <ul>
            <li onclick="showHideBox('about_box')">
                <img src="images/appbar.information.png" width="50px" />
                <span class="tooltiptext">Sobre</span>
            </li>
            <li onclick="showHideBox('settings_box')">
                <img src="images/appbar.cog.png" width="50px" />
                <span class="tooltiptext">Configurações</span>
            </li>
            <li onclick="showHideBox('time_settings_box')">
                <img src="images/appbar.timer.png" width="50px" />
                <span class="tooltiptext">Tempo de Simulação</span>
            </li>
            <li id="btn_play" onclick="playSimulation(this)">
                <img id="img_play" src="images/appbar.control.play.png" width="50px" />
                <span class="tooltiptext">Iniciar/Pausar</span>
            </li>
            <li onclick="stepSimulation()">
                <img src="images/appbar.control.step.forward.png" width="50px" />
                <span class="tooltiptext">Passo-a-Passo</span>
            </li>
            <li id="btn_stop" onclick="stopSimulation()">
                <img src="images/appbar.control.stop.png" width="50px" />
                <span class="tooltiptext">Parar</span>
            </li>
        </ul> 
    </div>
    <div id="main_box">
        <h3>Smail: Simulador de Servidores de E-mails</h3>
    </div>
    
    
    <div id="black_box"></div>
    <div id="about_box">Sobre</div>
    <div id="settings_box">
        <div class="scroll_box">
            <h3>Parâmetros de Simulação</h3>
            <br>
            <table border="0" style="width: 100%">
                
                <tr>
                    <td style="vertical-align: top;">
                        <table border="0">
                            <caption>Centros de Serviço</caption>
                            <tr>
                                <th style="text-align: left;">Centro de Serviço</th>
                                <th>Servidores</th>
                            </tr>
                            <tr>
                                <td class="label_field">Destino Local</td>
                                <td><input class="input_field" type="number" id="field_serversLocal"></td>
                            </tr>
                            <tr>
                                <td class="label_field">Destino Remoto</td>
                                <td><input class="input_field" type="number" id="field_serversRemote"></td>
                            </tr>
                        </table>
                    </td>
                    <td>
                        <table border="0">
                            <caption>Volume de Tráfego (%) Origem x Destino</caption>
                            <tr>
                                <th>Origem</th>
                                <th>Local</th>
                                <th>Remoto</th>
                            </tr>
                            <tr>
                                <td class="label_field">Local</td>
                                <td><input class="input_field" type="number" min="0" step="0.01" id="field_trafficLL"></td>
                                <td><input class="input_field" type="number" min="0" step="0.01" id="field_trafficLR"></td>
                            </tr>
                            <tr>
                                <td class="label_field">Remoto</td>
                                <td><input class="input_field" type="number" min="0" step="0.01" id="field_trafficRL"></td>
                                <td><input class="input_field" type="number" min="0" step="0.01" id="field_trafficRR"></td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr style="height: 15px;"></tr>
                <table border="0">
                    <caption>Proporção de Sucessos, Falhas e Adiamentos (%)</caption>
                    <tr>
                        <th style="text-align: left;">Direção</th>
                        <th>Sucesso</th>
                        <th>Falha</th>
                        <th>Adiamento</th>
                    </tr>
                    <tr>
                        <td class="label_field">Local -> Local</td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_rateSuccessLL"></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_rateFailureLL"></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_ratePostponementLL"></td>
                    </tr>
                    <tr>
                        <td class="label_field">Local -> Remoto</td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_rateSuccessLR"></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_rateFailureLR"></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_ratePostponementLR"></td>
                    </tr>
                    <tr>
                        <td class="label_field">Remoto -> Local</td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_rateSuccessRL"></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_rateFailureRL"></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_ratePostponementRL"></td>
                    </tr>
                    <tr>
                        <td class="label_field">Remoto -> Remoto</td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_rateSuccessRR"></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_rateFailureRR"></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_ratePostponementRR"></td>
                    </tr>
                </table>
                <br>
                <table border="0">
                    <caption>Tempo Entre Chegada de E-mails</caption>
                    <tr>
                        <th style="text-align: left;">Origem</th>
                        <th>Distribuição</th>
                    </tr>
                    <tr>
                        <td class="label_field">Local</td>
                        <td>
                            <select id="field_arrivalIntervalLocal" style="width: 100px;">
                                <option value="EXPO">Exponencial</option>
                                <option value="NORM" disabled>Normal</option>
                                <option value="TRIA" disabled>Triangular</option>
                                <option value="UNIF" disabled>Uniforme</option>
                            </select>
                        </td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_arrivalIntervalLocalParam1" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_arrivalIntervalLocalParam2" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_arrivalIntervalLocalParam3" disabled></td>                    
                    </tr>
                    <tr>
                        <td class="label_field">Remota</td>
                        <td>
                            <select id="field_arrivalIntervalRemote" style="width: 100px;">
                                <option value="EXPO">Exponencial</option>
                                <option value="NORM" disabled>Normal</option>
                                <option value="TRIA" disabled>Triangular</option>
                                <option value="UNIF" disabled>Uniforme</option>
                            </select>
                        </td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_arrivalIntervalRemoteParam1" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_arrivalIntervalRemoteParam2" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_arrivalIntervalRemoteParam3" disabled></td>                    
                    </tr>
                </table><br>
                <table border="0">
                    <caption>Tempo de Serviço de Acordo com o Tipo de Processamento</caption>
                    <tr>
                        <th style="text-align: left;">Processamento</th>
                        <th>Recepção</th>
                        <th>Distribuição</th>
                    </tr>
                    <tr>
                        <td class="label_field">LLS</td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLLSReception"></td>
                        <td>
                            <select id="field_procLLS" style="width: 100px;" onchange="updateFunctionParams(this)"></select>
                        </td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLLSParam1" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLLSParam2" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLLSParam3" disabled></td>
                    </tr>
                    <tr>
                        <td class="label_field">LLF</td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLLFReception"></td>
                        <td>
                            <select id="field_procLLF" style="width: 100px;" onchange="updateFunctionParams(this)"></select>
                        </td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLLFParam1" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLLFParam2" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLLFParam3" disabled></td>
                    </tr>
                    <tr>
                        <td class="label_field">LLA</td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLLAReception"></td>
                        <td>
                            <select id="field_procLLA" style="width: 100px;" onchange="updateFunctionParams(this)"></select>
                        </td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLLAParam1" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLLAParam2" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLLAParam3" disabled></td>
                    </tr>
                    <tr>
                        <td class="label_field">LRS</td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLRSReception"></td>
                        <td>
                            <select id="field_procLRS" style="width: 100px;" onchange="updateFunctionParams(this)"></select>
                        </td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLRSParam1" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLRSParam2" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLRSParam3" disabled></td>
                    </tr>
                    <tr>
                        <td class="label_field">LRF</td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLRFReception"></td>
                        <td>
                            <select id="field_procLRF" style="width: 100px;" onchange="updateFunctionParams(this)"></select>
                        </td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLRFParam1" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLRFParam2" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLRFParam3" disabled></td>
                    </tr>
                    <tr>
                        <td class="label_field">LRA</td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLRAReception"></td>
                        <td>
                            <select id="field_procLRA" style="width: 100px;" onchange="updateFunctionParams(this)"></select>
                        </td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLRAParam1" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLRAParam2" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procLRAParam3" disabled></td>
                    </tr>
                    <tr>
                        <td class="label_field">RLS</td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRLSReception"></td>
                        <td>
                            <select id="field_procRLS" style="width: 100px;" onchange="updateFunctionParams(this)"></select>
                        </td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRLSParam1" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRLSParam2" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRLSParam3" disabled></td>
                    </tr>
                    <tr>
                        <td class="label_field">RLF</td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRLFReception"></td>
                        <td>
                            <select id="field_procRLF" style="width: 100px;" onchange="updateFunctionParams(this)"></select>
                        </td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRLFParam1" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRLFParam2" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRLFParam3" disabled></td>
                    </tr>
                    <tr>
                        <td class="label_field">RLA</td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRLAReception"></td>
                        <td>
                            <select id="field_procRLA" style="width: 100px;" onchange="updateFunctionParams(this)"></select>
                        </td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRLAParam1" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRLAParam2" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRLAParam3" disabled></td>
                    </tr>
                    <tr>
                        <td class="label_field">RRS</td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRRSReception"></td>
                        <td>
                            <select id="field_procRRS" style="width: 100px;" onchange="updateFunctionParams(this)"></select>
                        </td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRRSParam1" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRRSParam2" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRRSParam3" disabled></td>
                    </tr>
                    <tr>
                        <td class="label_field">RRF</td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRRFReception"></td>
                        <td>
                            <select id="field_procRRF" style="width: 100px;" onchange="updateFunctionParams(this)"></select>
                        </td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRRFParam1" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRRFParam2" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRRFParam3" disabled></td>
                    </tr>
                    <tr>
                        <td class="label_field">RRA</td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRRAReception"></td>
                        <td>
                            <select id="field_procRRA" style="width: 100px;" onchange="updateFunctionParams(this)"></select>
                        </td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRRAParam1" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRRAParam2" disabled></td>
                        <td><input class="input_field" type="number" min="0" step="0.01" id="field_procRRAParam3" disabled></td>
                    </tr>
                </table>
            </table>
        </div>
    </div>
    
    <div id="time_settings_box">
        <table border="0">
            <tr>
                <td class="label_field">Tempo de Simulação</td>
                <td><input class="input_field" type="number" id="field_simulationTime"></td>
                <td>seg.</td>
            </tr>
            <tr>
                <td class="label_field">Semente de Aleatoriedade</td>
                <td><input class="input_field" type="number" id="field_simulationSeed"></td>
            </tr>
        </table>
    </div>

    <script>
        loadFunctionOptions(document.getElementById("field_procLLS"));
        loadFunctionOptions(document.getElementById("field_procLLF"));
        loadFunctionOptions(document.getElementById("field_procLLA"));
        loadFunctionOptions(document.getElementById("field_procLRS"));
        loadFunctionOptions(document.getElementById("field_procLRF"));
        loadFunctionOptions(document.getElementById("field_procLRA"));
        loadFunctionOptions(document.getElementById("field_procRLS"));
        loadFunctionOptions(document.getElementById("field_procRLF"));
        loadFunctionOptions(document.getElementById("field_procRLA"));
        loadFunctionOptions(document.getElementById("field_procRRS"));
        loadFunctionOptions(document.getElementById("field_procRRF"));
        loadFunctionOptions(document.getElementById("field_procRRA"));
        
        var simulation = new Simulation();
        var simulator = new Simulator();
        loadDefaultSettings();
        
        function loadFunctionOptions(selectElement) {
            console.log("Method call: loadFunctionOptions(selectElement)");
            
            for(i = 0; i < Function.SIZE; i++) {
                option = document.createElement("option");
                option.value = Function.NUMBER[Function.INDEX[i]];
                // option.disabled = true;
                option.innerHTML = Function.NAME[Function.INDEX[i]];
                selectElement.options.add(option, i);
            }
        }
        
        function updateFunctionParams(selectElement) {
            console.log("Method call: updateFunctionParams(selectElement)");
            
            selectedFunction = selectElement.options[selectElement.selectedIndex].value;
            functionParams = Function.PARAMS[Function.INDEX[selectedFunction] || Function.INDEX[0]];
            
            document.getElementById(selectElement.id + "Param1").disabled = true;
            document.getElementById(selectElement.id + "Param2").disabled = true;
            document.getElementById(selectElement.id + "Param3").disabled = true;
            document.getElementById(selectElement.id + "Param1").title = "";
            document.getElementById(selectElement.id + "Param2").title = "";
            document.getElementById(selectElement.id + "Param3").title = "";
            
            switch(functionParams.length) {
                case 3:
                    document.getElementById(selectElement.id + "Param3").disabled = false;
                    document.getElementById(selectElement.id + "Param3").title = functionParams[2];
                case 2:
                    document.getElementById(selectElement.id + "Param2").disabled = false;
                    document.getElementById(selectElement.id + "Param2").title = functionParams[1];
                case 1:
                    document.getElementById(selectElement.id + "Param1").disabled = false;
                    document.getElementById(selectElement.id + "Param1").title = functionParams[0];
                default:
                    break;
            }
        }
    
        function playSimulation(src) {
            console.log("Method call: playSimulation(src)");
            
            if(src.id == "btn_play") {
                src.id = "btn_pause";
                document.getElementById("img_play").setAttribute("src", "images/appbar.control.pause.png");
                simulator.runSimulation();
            } else {
                src.id = "btn_play";
                document.getElementById("img_play").setAttribute("src", "images/appbar.control.play.png");
                simulator.pauseSimulation();
            }
        }
        
        function stepSimulation() {
            console.log("Method call: stepSimulation()");
            
            simulator.pauseSimulation();
            simulator.runStep();
        }
        
        function stopSimulation() {
            console.log("Method call: stopSimulation()");
            
            document.getElementById("img_play").setAttribute("src", "images/appbar.control.play.png");
            document.getElementById("img_play").parentElement.id = "btn_play";
            simulator.stopSimulation();
        }
        
        function showHideBox(divId) {
            console.log("Method call: showHideBox(divId)");
            
            // Se o container está visível, torna invisível, e vice-versa
            if(document.getElementById(divId).style.opacity == 0) {
                document.getElementById(divId).style.visibility = 'visible';
                document.getElementById(divId).style.opacity = 1;
            } else {
                document.getElementById(divId).style.opacity = 0;
                document.getElementById(divId).style.visibility = 'hidden';
            }
            
            // Se alguma das caixas de informação/configuração estiver ativa,
            // então esmaece a tela
            if(document.getElementById('about_box').style.visibility == 'visible'
              || document.getElementById('settings_box').style.visibility == 'visible'
              || document.getElementById('time_settings_box').style.visibility == 'visible') {
                document.getElementById('black_box').style.visibility = 'visible';
                document.getElementById('black_box').style.opacity = 0.7;                
            } else {
                document.getElementById('black_box').style.opacity = 0;
                document.getElementById('black_box').style.visibility = 'hidden';
            }
        }
        
        function loadDefaultSettings() {
            console.log("Method call: loadDefaultSettings()");
            
            document.getElementById('field_simulationTime').value = simulation.simulationTime; 
            document.getElementById('field_simulationSeed').value = simulation.simulationSeed;          
            
            document.getElementById('field_serversLocal').value = simulator.localServiceCenter.numberOfServers;
            document.getElementById('field_serversRemote').value = simulator.remoteServiceCenter.numberOfServers;
            
            document.getElementById('field_trafficLL').value = simulation.traffic[Direction.NUMBER.LL];
            document.getElementById('field_trafficLR').value = simulation.traffic[Direction.NUMBER.LR];
            document.getElementById('field_trafficRL').value = simulation.traffic[Direction.NUMBER.RL];
            document.getElementById('field_trafficRR').value = simulation.traffic[Direction.NUMBER.RR];
            
            document.getElementById('field_rateSuccessLL').value = simulation.trafficRate[Direction.NUMBER.LL][0];
            document.getElementById('field_rateFailureLL').value = simulation.trafficRate[Direction.NUMBER.LL][1];
            document.getElementById('field_ratePostponementLL').value = simulation.trafficRate[Direction.NUMBER.LL][2];
            
            document.getElementById('field_rateSuccessLR').value = simulation.trafficRate[Direction.NUMBER.LR][0];
            document.getElementById('field_rateFailureLR').value = simulation.trafficRate[Direction.NUMBER.LR][1];
            document.getElementById('field_ratePostponementLR').value = simulation.trafficRate[Direction.NUMBER.LR][2];
            
            document.getElementById('field_rateSuccessRL').value = simulation.trafficRate[Direction.NUMBER.RL][0];
            document.getElementById('field_rateFailureRL').value = simulation.trafficRate[Direction.NUMBER.RL][1];
            document.getElementById('field_ratePostponementRL').value = simulation.trafficRate[Direction.NUMBER.RL][2];
            
            document.getElementById('field_rateSuccessRR').value = simulation.trafficRate[Direction.NUMBER.RR][0];
            document.getElementById('field_rateFailureRR').value = simulation.trafficRate[Direction.NUMBER.RR][1];
            document.getElementById('field_ratePostponementRR').value = simulation.trafficRate[Direction.NUMBER.RR][2];
            
            for(i = 0; i < Direction.SIZE; i++) {
                for(j = 0; j < Status.SIZE; j++) {
                    document.getElementById('field_proc' + Direction.INDEX[i] + Status.INDEX[j] + "Reception").value = simulation.processing[Direction.INDEX[i]][j][0];
                    func = simulation.processing[Direction.INDEX[i]][j][1];
                    // funcParams = Function.PARAMS[Function.INDEX[func]];
                    
                    // for(i = 0; i < funcParams.length; i++)
                    //    document.getElementById('field_proc' + Direction.INDEX[i] + Status.INDEX[j] + "Param" + (i+1)).value = simulation.processing[Direction.INDEX[i]][j][i+2];
                    
                    // document.getElementById('field_proc' + Direction.INDEX[i] + Status.INDEX[j]).value = Function.NAME[Function.INDEX[simulation.processing[Direction.INDEX[i]][j][1]]];
                    
                }
            }
        }
    </script>
</body>
    
</html>